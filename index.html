<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./pages/index.css">
</head>

<body>
    <main>
        <section class="section">
            <div class="container">
                <h1 class="title-page">
                    Рейтинг друзей
                </h1>
                <ul class="cards-list">
                    <li class="card">
                        <div class="card__image-wrapper">
                            <img alt="" src="./images/avatar-1.webp" class="card__image">
                        </div>
                        <p class="card__name">
                            Тилик
                        </p>
                        <div class="card__control">
                            <button class="card__control-button card__control-button__delete"></button>
                            <span class="card__control-count">0</span>
                            <button class="card__control-button card__control-button__add"></button>
                        </div>
                        <ul class="card__comment-list">
                            <div class="card__other-comment">
                                <span class="card__other-text">
                                    Пока пусто
                                </span>
                            </div>
                        </ul>
                    </li>

                    <li class="card">
                        <div class="card__image-wrapper">
                            <img alt="" src="./images/avatar-2.webp" class="card__image">
                        </div>
                        <p class="card__name">
                            Темик
                        </p>
                        <div class="card__control">
                            <button class="card__control-button card__control-button__delete"></button>
                            <span class="card__control-count">0</span>
                            <button class="card__control-button card__control-button__add"></button>
                        </div>
                        <ul class="card__comment-list">
                            <div class="card__other-comment">
                                <span class="card__other-text">
                                    Пока пусто
                                </span>
                            </div>
                        </ul>
                    </li>

                    <li class="card">
                        <div class="card__image-wrapper">
                            <img alt="" src="./images/avatar-3.webp" class="card__image">
                        </div>
                        <p class="card__name">
                            Ирэн
                        </p>
                        <div class="card__control">
                            <button class="card__control-button card__control-button__delete"></button>
                            <span class="card__control-count">0</span>
                            <button class="card__control-button card__control-button__add"></button>
                        </div>
                        <ul class="card__comment-list">
                            <div class="card__other-comment">
                                <span class="card__other-text">
                                    Пока пусто
                                </span>
                            </div>
                        </ul>
                    </li>

                    <li class="card">
                        <div class="card__image-wrapper">
                            <img alt="" src="./images/avatar-4.webp" class="card__image">
                        </div>
                        <p class="card__name">
                            Татьян
                        </p>
                        <div class="card__control">
                            <button class="card__control-button card__control-button__delete"></button>
                            <span class="card__control-count">0</span>
                            <button class="card__control-button card__control-button__add"></button>
                        </div>
                        <ul class="card__comment-list">
                            <div class="card__other-comment">
                                <span class="card__other-text">
                                    Пока пусто
                                </span>
                            </div>
                        </ul>
                    </li>

                    <li class="card">
                        <div class="card__image-wrapper">
                            <img alt="" src="./images/avatar-5.webp" class="card__image">
                        </div>
                        <p class="card__name">
                            Катя
                        </p>
                        <div class="card__control">
                            <button class="card__control-button card__control-button__delete"></button>
                            <span class="card__control-count">0</span>
                            <button class="card__control-button card__control-button__add"></button>
                        </div>
                        <ul class="card__comment-list">
                            <div class="card__other-comment">
                                <span class="card__other-text">
                                    Пока пусто
                                </span>
                            </div>
                        </ul>
                    </li>

                    <li class="card">
                        <div class="card__image-wrapper">
                            <img alt="" src="./images/avatar-6.webp" class="card__image">
                        </div>
                        <p class="card__name">
                            Настя
                        </p>
                        <div class="card__control">
                            <button class="card__control-button card__control-button__delete"></button>
                            <span class="card__control-count">0</span>
                            <button class="card__control-button card__control-button__add"></button>
                        </div>
                        <ul class="card__comment-list">
                            <div class="card__other-comment">
                                <span class="card__other-text">
                                    Пока пусто
                                </span>
                            </div>
                        </ul>
                    </li>
                </ul>
            </div>
        </section>
        <section class="popup">
            <div class="popup__block">
                <button class="popup__close"></button>
                <h2 class="popup__title">
                    Обоснуй свою оценку
                </h2>
                <form name="popupForm" class="popup__form" action="">
                    <div class="popup__inputs-wrapper">
                        <div class="popup__dropdown">
                            <div class="popup__input popup__input-header">
                                <span class="popup__input-label">Ты кто?</span>
                                <div class="popup__input-arrow"></div>
                            </div>
                            <ul class="popup__input-body">
                                <li class="popup__input-item">Тилик</li>
                                <li class="popup__input-item">Темик</li>
                                <li class="popup__input-item">Ирэн</li>
                                <li class="popup__input-item">Татьян</li>
                                <li class="popup__input-item">Катя</li>
                                <li class="popup__input-item">Настя</li>
                            </ul>
                        </div>
                        <textarea class="popup__input popup__input_comment" placeholder="Ну давай..."></textarea>
                    </div>
                    <span class="popup__error">
                        Ты долбаеб? Тут всего 2 формы и ты не можешь их все заполнить????
                    </span>
                    <button type="submit" class="popup__submit">
                        Отправить
                    </button>
                </form>
            </div>
        </section>
    </main>
</body>

</html>

<script>
    const cards = document.querySelectorAll('.card');

    const popup = document.querySelector('.popup');
    const popupForm = document.querySelector('.popup__form');
    const popupCloseButton = document.querySelector('.popup__close');
    const popupDropdown = document.querySelector('.popup__dropdown');
    const popupHeader = document.querySelector('.popup__input-header');
    const popupProfileItems = document.querySelectorAll('.popup__input-item');
    const popupProfileLabel = document.querySelector('.popup__input-label');
    const commentInput = document.querySelector('.popup__input_comment');
    const popupError = document.querySelector('.popup__error');
    const popupSubmit = document.querySelector('.popup__submit');

    let activeCardCommentList = null;
    let isGoodComment = true;

    function popupOpen() {
        popup.classList.add('popup_show');
    }

    function popupClose() {
        popup.classList.remove('popup_show');
    }

    function changeProfilePopup() {
        popupProfileItems.forEach((profile) => {
            profile.addEventListener('click', () => {
                popupProfileLabel.textContent = profile.textContent;
                popupHeader.classList.add('popup__input-header__change');
                popupDropdown.classList.remove('popup__dropdown_open');
            });
        });
    }

    function getTodayDate() {
        const now = new Date();
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        return `${day}.${month}`;
    }

    function validateForm() {
        if (commentInput.value.trim() !== '' && popupProfileLabel.textContent !== 'Ты кто?') {
            popupError.classList.remove('popup__error--show');
            return true;
        } else {
            popupError.classList.add('popup__error--show');
            return false;
        }
    }

    function addCommentCard(author, comment, isGood) {
        const commentCard = document.createElement('li');
        commentCard.className = 'card__comment';
        commentCard.innerHTML = `
    <div class="card__comment-info">
      <span class="card__comment-date">${getTodayDate()}</span>
      <span class="card__comment-author">${author}</span>
      <span class="card__comment-count ${isGood ? 'card__comment-count__good' : 'card__comment-count__bad'}">${isGood ? '+1' : '-1'}</span>
    </div>
    <p class="card__comment-text">${comment}</p>
  `;
        return commentCard;
    }

    cards.forEach((item) => {
        const buttonMinus = item.querySelector('.card__control-button__delete');
        const buttonPlus = item.querySelector('.card__control-button__add');
        const counterValue = item.querySelector('.card__control-count');
        let counter = 0;
        const commentList = item.querySelector('.card__comment-list');

        buttonMinus.addEventListener('click', () => {
            popupOpen();
            activeCardCommentList = commentList;
            counter--;
            counterValue.innerHTML = counter;

            if (counter < 0) {
                counterValue.classList.remove('card__control-count__good');
                counterValue.classList.add('card__control-count__bad');
            } else if (counter === 0) {
                counterValue.classList.remove('card__control-count__bad');
                counterValue.classList.remove('card__control-count__good');
            }
        });

        buttonPlus.addEventListener('click', () => {
            popupOpen();
            activeCardCommentList = commentList;
            counter++;
            counterValue.innerHTML = counter;

            if (counter > 0) {
                counterValue.classList.remove('card__control-count__bad');
                counterValue.classList.add('card__control-count__good');
            } else if (counter === 0) {
                counterValue.classList.remove('card__control-count__bad');
                counterValue.classList.remove('card__control-count__good');
            }
        });
    });

    popupCloseButton.addEventListener('click', () => {
        popupClose();
    });

    popupHeader.addEventListener('click', () => {
        popupDropdown.classList.add('popup__dropdown_open');
    });

    changeProfilePopup();

    popupForm.addEventListener('submit', (e) => {
        e.preventDefault();

        if (validateForm()) {
            const authorName = popupProfileLabel.textContent;
            const commentText = commentInput.value.trim();

            if (activeCardCommentList) {
                const emptyCard = activeCardCommentList.querySelector('.card__other-comment');
                const newComment = addCommentCard(authorName, commentText);
                activeCardCommentList.prepend(newComment);
                emptyCard.style.display = 'none'
            }

            popupProfileLabel.textContent = 'Ты кто?';
            commentInput.value = '';
            popupHeader.classList.remove('popup__input-header__change');

            popupClose();
        }
    });

</script>